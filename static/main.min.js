"use strict";var config={apiKey:"AIzaSyABu7_D7zwu9Eu0bho9B8J6x9xaH2T0OmA",authDomain:"bot-experiment.firebaseapp.com",databaseURL:"https://bot-experiment.firebaseio.com",projectId:"bot-experiment",storageBucket:"",messagingSenderId:"675533221024"};firebase.initializeApp(config);var list=[{hasBot:!1,condition:"All for"},{hasBot:!1,condition:"All against"},{hasBot:!1,condition:"All neutral"},{hasBot:!1,condition:"Combination"},{hasBot:!0,condition:"All for",botType:"Signal I- condition1 (Strict)"},{hasBot:!0,condition:"All against",botType:"Signal I- condition1 (Strict)"},{hasBot:!0,condition:"All neutral",botType:"Signal I- condition1 (Strict)"},{hasBot:!0,condition:"Combination",botType:"Signal I- condition1 (Strict)"},{hasBot:!0,condition:"All for",botType:"Signal I- condition2 (Loose)"},{hasBot:!0,condition:"All against",botType:"Signal I- condition2 (Loose)"},{hasBot:!0,condition:"All neutral",botType:"Signal I- condition2 (Loose)"},{hasBot:!0,condition:"Combination",botType:"Signal I- condition2 (Loose)"},{hasBot:!0,condition:"All for",botType:"Signal II- condition1 (Strict)"},{hasBot:!0,condition:"All against",botType:"Signal II- condition1 (Strict)"},{hasBot:!0,condition:"All neutral",botType:"Signal II- condition1 (Strict)"},{hasBot:!0,condition:"Combination",botType:"Signal II- condition1 (Strict)"},{hasBot:!0,condition:"All for",botType:"Signal II- condition2 (Loose)"},{hasBot:!0,condition:"All against",botType:"Signal II- condition2 (Loose)"},{hasBot:!0,condition:"All neutral",botType:"Signal II- condition2 (Loose)"},{hasBot:!0,condition:"Combination",botType:"Signal II- condition2 (Loose)"}],getRandomInt=function(){return Math.floor(Math.random()*Math.floor(20))},getQueryVariable=function(a){for(var f,b=window.location.search.substring(1),d=b.split("&"),e=0;e<d.length;e++)if(f=d[e].split("="),decodeURIComponent(f[0])==a)return decodeURIComponent(f[1]);return""};new Vue({el:"#app",data:{which:null,condition:null,hasBot:null,botType:null,strictness:null,comments:[],allReplies:[],selectedComment:null,showBotDialog:null,showGuideline:!1,showReportDialog:!1,showUserDialog:!0,userData:{case:void 0,email:"",comments:[],up:[],down:[],bot:[],reports:[]}},computed:{replies:function replies(){var b=this,a=list[this.which];return this.allReplies.filter(function(d){return d.comment_text===b.selectedComment.comment_text&&d.Condition===a.condition})},userEmail:function userEmail(){return this.userData.email}},watch:{userEmail:function userEmail(){var b=this;firebase.database().ref(btoa(this.userData.email+"_"+this.which)).once("value").then(function(d){var e=d.val();e&&Object.keys(e).forEach(function(f){"email"===f||Vue.set(b.userData,f,e[f])})})}},created:function created(){var b=this;this.which=parseInt(atob(getQueryVariable("id")),10);var a=list[this.which];Vue.set(this.userData,"case",Object.assign({id:this.which,code:getQueryVariable("id")},a)),fetch("static/comments.csv").then(function(d){return d.text()}).then(function(d){b.comments=Papa.parse(d,{header:!0}).data.filter(function(e){return e.Condition===a.condition}).map(function(e){return Object.assign({},e,{hasBot:a.hasBot,botInfo:a.hasBot&&e[a.botType]})})}),fetch("static/replies.csv").then(function(d){return d.text()}).then(function(d){b.allReplies=Papa.parse(d,{header:!0}).data})},methods:{login:function login(){this.validateEmail(this.userData.email)&&(this.showUserDialog=!1)},logout:function logout(){Vue.set(this.userData,"email",""),this.showUserDialog=!0},showRepliesOf:function showRepliesOf(a){this.selectedComment=a},replyTo:function replyTo(a){var d=this,b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:null;a&&(this.selectedComment=a),b&&(this.selectedReply=b),Vue.nextTick().then(function(){d.$refs.reply.value="@"+(a?a.nickname:b.reply_nickname)+" "}).then(function(){d.$refs.reply.focus()})},closeModal:function closeModal(){this.selectedComment=null},vote:function vote(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:null,d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(this.beforeAction()){var e=this.userData[a].findIndex(function(h){return h.mid===b&&h.rid===d});if(-1!==e)Vue.delete(this.userData[a],e);else{this.userData[a].push({mid:b,rid:d});var f="up"===a?"down":"up",g=this.userData[f].findIndex(function(h){return h.mid===b&&h.rid===d});-1!==g&&Vue.delete(this.userData[f],g)}this.save()}},isVoted:function isVoted(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:null,d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;return-1!==this.userData[a].findIndex(function(e){return(e.mid||null)===b&&(e.rid||null)===d})},replyCount:function replyCount(a){return parseInt(a.reply_count,10)+this.userData.comments.filter(function(b){return b.mid===a.message_id}).length},feedback:function feedback(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:null;this.beforeAction()&&(this.userData.bot.push({mid:b,feedback:a}),"Agree"===a?this.showReportDialog=!0:(this.showBotDialog=!0,this.currentMID=b),this.save())},isFeedbackSet:function isFeedbackSet(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:null;return-1!==this.userData.bot.findIndex(function(b){return(b.mid||null)===a})},report:function report(a){this.beforeAction()&&(this.userData.reports.push(a),this.save(),this.showReportDialog=!0)},isReported:function isReported(a){return this.userData.reports.includes(a)},moreFeedback:function moreFeedback(a){var d=this,b=this.userData.bot.findIndex(function(e){return e.mid===d.currentMID});-1===b||(Vue.set(this.userData.bot[b],"strictness",a),this.showBotDialog=!1,this.currentMID=null,this.save())},validateEmail:function validateEmail(a){var b=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return b.test((a+"").toLowerCase())},post:function post(){return this.beforeAction()?""===(this.selectedComment?this.$refs.reply.value:this.$refs.comment.value).trim()?void alert("Content cannot be empty."):void(this.userData.comments.push({mid:this.selectedComment?this.selectedComment.message_id:null,rid:this.selectedReply?this.selectedReply.reply_id:null,content:this.selectedComment?this.$refs.reply.value:this.$refs.comment.value,createdAt:new Date().toLocaleString("en-US",{year:"2-digit",month:"numeric",day:"numeric",hour:"numeric",minute:"2-digit"})}),this.selectedComment?this.$refs.reply.value="":this.$refs.comment.value="",this.save()):void 0},beforeAction:function beforeAction(){return!!this.validateEmail(this.userData.email)||(alert("Please enter a valid email first."),this.selectedComment?this.$refs.replyEmail.focus():this.$refs.commentEmail.focus(),!1)},save:function save(){this.userData.email&&firebase.database().ref(btoa(this.userData.email+"_"+this.which)).set(this.userData)}}});