"use strict";var config={apiKey:"AIzaSyABu7_D7zwu9Eu0bho9B8J6x9xaH2T0OmA",authDomain:"bot-experiment.firebaseapp.com",databaseURL:"https://bot-experiment.firebaseio.com",projectId:"bot-experiment",storageBucket:"",messagingSenderId:"675533221024"};firebase.initializeApp(config);var list=[{hasFlag:!1},{hasFlag:!0,hasBot:!0,key:"V/Acc/HU"},{hasFlag:!0,hasBot:!0,key:"V/Acc/LU"},{hasFlag:!0,hasBot:!0,key:"V/Inacc/HU"},{hasFlag:!0,hasBot:!0,key:"V/Inacc/LU"},{hasFlag:!0,key:"IV/Acc/HU"},{hasFlag:!0,key:"IV/Acc/LU"},{hasFlag:!0,key:"IV/Inacc/HU"},{hasFlag:!0,key:"IV/Inacc/LU"}],getRandomInt=function(){return Math.floor(Math.random()*Math.floor(9))},getQueryVariable=function(a){for(var g,b=window.location.search.substring(1),d=b.split("&"),f=0;f<d.length;f++)if(g=d[f].split("="),decodeURIComponent(g[0])==a)return decodeURIComponent(g[1]);return""};new Vue({el:"#app",data:{which:null,condition:null,hasFlag:null,botType:null,strictness:null,comments:[],allReplies:[],selectedComment:null,showBotDialog:null,showSlides:!0,currentSlide:1,lastSlide:9,showReportDialog:!1,showUserDialog:!0,showingTooltip:!1,userData:{case:void 0,email:"",comments:[],up:[],down:[],bot:[],reports:[]}},computed:{replies:function replies(){var b=this,a=list[this.which];return this.allReplies.filter(function(d){return d.comment_text===b.selectedComment.comment_text&&d.Condition===a.condition})},userEmail:function userEmail(){return this.userData.email},isLastSlide:function isLastSlide(){return this.currentSlide===this.lastSlide}},watch:{userEmail:function userEmail(){var b=this;firebase.database().ref(btoa(this.userData.email+"_"+this.which)).once("value").then(function(d){var f=d.val();f&&Object.keys(f).forEach(function(g){"email"===g||Vue.set(b.userData,g,f[g])})})}},created:function created(){var b=this;this.which=parseInt(atob(getQueryVariable("id")),10),this.lastSlide=0===this.which?9:10;var a=list[this.which];this.c=a,Vue.set(this.userData,"case",Object.assign({id:this.which,code:getQueryVariable("id")},a)),fetch("static/comments.csv").then(function(d){return d.text()}).then(function(d){b.comments=Papa.parse(d,{header:!0}).data.map(function(f){return Object.assign({},f,{hasFlag:a.hasFlag,hasBot:a.hasBot,flagInfo:a.hasFlag&&f[a.key]})})}),fetch("static/replies.csv").then(function(d){return d.text()}).then(function(d){b.allReplies=Papa.parse(d,{header:!0}).data})},methods:{showTooltip:function showTooltip(a){var b=document.getElementById("tooltip");b.style.left=a.pageX-340+"px",b.style.top=a.pageY-20+"px",this.showingTooltip=!0},hideTooltip:function hideTooltip(){this.showingTooltip=!1},login:function login(){this.validateEmail(this.userData.email)&&(this.showUserDialog=!1)},logout:function logout(){Vue.set(this.userData,"email",""),Vue.set(this.userData,"comments",[]),Vue.set(this.userData,"up",[]),Vue.set(this.userData,"down",[]),Vue.set(this.userData,"bot",[]),Vue.set(this.userData,"reports",[]),this.showUserDialog=!0},showRepliesOf:function showRepliesOf(a){this.selectedComment=a},replyTo:function replyTo(a){var d=this,b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:null;a&&(this.selectedComment=a),b&&(this.selectedReply=b),Vue.nextTick().then(function(){d.$refs.reply.value="@"+(a?a.nickname:b.reply_nickname)+" "}).then(function(){d.$refs.reply.focus()})},closeModal:function closeModal(){this.selectedComment=null},vote:function vote(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:null,d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(this.beforeAction()){var f=this.userData[a].findIndex(function(j){return j.mid===b&&j.rid===d});if(-1!==f)Vue.delete(this.userData[a],f);else{this.userData[a].push({mid:b,rid:d});var g="up"===a?"down":"up",h=this.userData[g].findIndex(function(j){return j.mid===b&&j.rid===d});-1!==h&&Vue.delete(this.userData[g],h)}this.save()}},isVoted:function isVoted(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:null,d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;return-1!==this.userData[a].findIndex(function(f){return(f.mid||null)===b&&(f.rid||null)===d})},replyCount:function replyCount(a){return parseInt(a.reply_count,10)+this.userData.comments.filter(function(b){return b.mid===a.message_id}).length},feedback:function feedback(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:null;this.beforeAction()&&("Change"===a?this.userData.bot.splice(this.userData.bot.findIndex(function(d){return d.mid===b}),1):(this.userData.bot.push({mid:b,feedback:a}),this.showBotDialog=!0,this.currentMID=b),this.save())},isFeedbackSet:function isFeedbackSet(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:null;return this.userData.bot.find(function(b){return(b.mid||null)===a})},report:function report(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:!0;this.beforeAction()&&(b?(this.userData.reports.push(a),this.showReportDialog=!0):this.userData.reports.splice(this.userData.reports.findIndex(function(d){return d===a}),1),this.save())},isReported:function isReported(a){return this.userData.reports.includes(a)},moreFeedback:function moreFeedback(a){var d=this,b=this.userData.bot.findIndex(function(f){return f.mid===d.currentMID});-1===b||(Vue.set(this.userData.bot[b],"strictness",a),this.showBotDialog=!1,this.currentMID=null,this.save())},validateEmail:function validateEmail(a){var b=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return b.test((a+"").toLowerCase())},post:function post(){if(this.beforeAction()){if(""===(this.selectedComment?this.$refs.reply.value:this.$refs.comment.value).trim())return void alert("Content cannot be empty.");this.userData.comments.push({mid:this.selectedComment?this.selectedComment.message_id:null,rid:this.selectedReply?this.selectedReply.reply_id:null,content:this.selectedComment?this.$refs.reply.value:this.$refs.comment.value,createdAt:new Date().toLocaleString("en-US",{year:"2-digit",month:"numeric",day:"numeric",hour:"numeric",minute:"2-digit"})}),this.selectedComment?this.$refs.reply.value="":this.$refs.comment.value="",this.save();var a=document.scrollingElement||document.body;a.scrollTo({top:a.scrollHeight,behavior:"smooth"})}},beforeAction:function beforeAction(){return!!this.validateEmail(this.userData.email)||(alert("Please enter a valid email first."),this.selectedComment?this.$refs.replyEmail.focus():this.$refs.commentEmail.focus(),!1)},save:function save(){this.userData.email&&firebase.database().ref(btoa(this.userData.email+"_"+this.which)).set(this.userData)},prevSlide:function prevSlide(){1===this.currentSlide||(this.currentSlide-=1)},nextSlide:function nextSlide(){return this.currentSlide===this.lastSlide?void(this.showSlides=!1):void(this.currentSlide+=1)}}});